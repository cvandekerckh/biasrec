{% extends "main/base_rate.html" %}

{% block content %}

  <body>
    <h1 class="titlecolor"> Hi, User {{ current_user.code }}! Could you please rate all the following movies ? </h1>
    {% for product in products %}
      {% if product.id in [1080,260,1387,1380,1214,1136,1997,1193,1196,616,344,2571,593,356,480,150,1407,318,3081,1,4973,4993,4226,7361,3793,4896,4720,4878,4975,4306,88163,79132,91529,97921,84152,109487,83134,99114,98809,76093] %}
        <div>
,            <p>
                <table class="table table-hover">
                    <tr>
                        <td width="200px", ALIGN="CENTER", style="float:left;width:40%;">
                            <br>
                            <br>
                            <img src="{{ url_for('static', filename='img/{}.jpg'.format(product.image))}}"  height="350px">
                        </td>
                        <td style="float:left;width:40%;">
                            <h2><b>{{product.name}}</b></h2>
                            <ul>
                              <li><h4><b>Year :</b> {{product.feature_1}}</h4></li>
                              <li><h4><b>Genre(s) :</b> {{product.feature_2}}</h4></li>
                              <li><h4><b>Actors :</b> {{product.feature_3}}</h4></li>
                              <li><h4><b>User score :</b> {{product.feature_4}}</h4></li>
                              <li style="text-align: justify;">
                                <h4><b>Overview :</b><i> {{product.nutri_score}}</i></h4>
                              </li>                           
                              <h4> <a href="{{ product.price }}">Click to watch the trailer</a> </h4> 
                            </ul>
                            <div class="rate">
                            <h3><b>Your rating : </b></h3> 
                              <div id="{{ product.id }}"></div>  
                          </div>
                        </td>
                    </tr>
                </table>
            </p>
        </div>
      {% endif %}
    {% endfor %}

    <br>
    <footer style="position: fixed; bottom: 0; left: 0; width: 100%; text-align: right;">
      <div>
        {% if not current_user.is_anonymous %}
        <h4 style="color: red;">Once you have finished rating all the</h4>
        <h4 style="color: red;">movies, click on the button below : </h4>
        <a href="{{ url_for('main.survey1')}}" style="font-size: 24px; font-weight: bold; color:rgb(89, 108, 71);">Next step : First survey</a>
        {% endif %}
      </div>
    </footer>
  </body>
{% endblock %}

{% block scripts %}

  <script>
    
    // Define a function to handle star clicks
    function handleStarClick(stars, productId) {
        let data = new FormData();
        data.append("stars", stars);
        data.append("product_id", productId);
        fetch("/save/", {
            method: "post",
            body: data
        })
        .then(res => res.text())
        .then(txt => {
            if (txt == "OK") { location.reload(); }
            else { alert(txt); }
        });
    }

    // Loop through products and ratings arrays for selected movies
    {% for product in products %}
      {% if product.id in [1080,260,1387,1380,1214,1136,1997,1193,1196,616,344,2571,593,356,480,150,1407,318,3081,1,4973,4993,4226,7361,3793,4896,4720,4878,4975,4306,88163,79132,91529,97921,84152,109487,83134,99114,98809,76093] %}
        starry({
          target: document.getElementById("{{ product.id }}"),
          max: 5,
          now: {{ ratings[products.index(product)] }},
          click: stars => handleStarClick(stars, "{{ product.id }}")
        });
      {% endif %}
    {% endfor %}

  </script>
{% endblock %}




